{% extends 'base.html' %}

{% block title %}تعديل الملف الشخصي - سوسيال{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">تعديل الملف الشخصي</h1>
        <p class="text-gray-600 mt-2">تعديل معلومات حسابك وشخصيتك</p>
    </div>
    
    <!-- الرسائل -->
    {% if messages %}
    <div class="mb-6">
        {% for message in messages %}
        <div class="{% if message.tags == 'success' %}bg-green-100 border-green-400 text-green-700
                    {% elif message.tags == 'error' %}bg-red-100 border-red-400 text-red-700
                    {% else %}bg-blue-100 border-blue-400 text-blue-700{% endif %} 
                    border px-4 py-3 rounded mb-2">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="bg-white rounded-lg shadow">
        <form method="POST" enctype="multipart/form-data" class="p-6">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- الصور -->
                <div class="space-y-6">
                    <!-- الصورة الشخصية -->
                    <div>
                        <h3 class="font-bold text-lg mb-4">الصورة الشخصية</h3>
                        <div class="text-center">
                            <div id="profile-image-preview" class="relative inline-block">
                                {% if user.profile_image %}
                                    <img src="{{ user.profile_image.url }}" 
                                         class="h-40 w-40 rounded-full object-cover border-4 border-white shadow-lg">
                                {% else %}
                                    <div class="h-40 w-40 rounded-full border-4 border-white bg-gray-200 flex items-center justify-center shadow-lg">
                                        <i class="fas fa-user text-gray-400 text-5xl"></i>
                                    </div>
                                {% endif %}
                                <label for="profile_image" 
                                       class="absolute bottom-2 right-2 bg-blue-500 text-white p-2 rounded-full cursor-pointer hover:bg-blue-600">
                                    <i class="fas fa-camera"></i>
                                </label>
                            </div>
                            <input type="file" id="profile_image" name="profile_image" accept="image/*" 
                                   class="hidden" onchange="previewProfileImage(this)">
                            <p class="text-gray-500 text-sm mt-2">انقر على الأيقونة لتغيير الصورة</p>
                        </div>
                    </div>
                    
                    <!-- صورة الغلاف -->
                    <div>
                        <h3 class="font-bold text-lg mb-4">صورة الغلاف</h3>
                        <div class="text-center">
                            <div id="cover-image-preview" class="relative rounded-lg overflow-hidden">
                                {% if user.cover_image %}
                                    <img src="{{ user.cover_image.url }}" 
                                         class="h-40 w-full object-cover">
                                {% else %}
                                    <div class="h-40 w-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center">
                                        <i class="fas fa-image text-white text-4xl opacity-50"></i>
                                    </div>
                                {% endif %}
                                <label for="cover_image" 
                                       class="absolute bottom-4 right-4 bg-blue-500 text-white p-2 rounded-full cursor-pointer hover:bg-blue-600">
                                    <i class="fas fa-camera"></i>
                                </label>
                            </div>
                            <input type="file" id="cover_image" name="cover_image" accept="image/*" 
                                   class="hidden" onchange="previewCoverImage(this)">
                            <p class="text-gray-500 text-sm mt-2">انقر على الأيقونة لتغيير صورة الغلاف</p>
                        </div>
                    </div>
                </div>
                
                <!-- معلومات المستخدم -->
                <div class="space-y-6">
                    <!-- الاسم -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="first_name" class="block text-gray-700 mb-2">الاسم الأول</label>
                            <input type="text" id="first_name" name="first_name" 
                                   value="{{ user.first_name|default:'' }}"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label for="last_name" class="block text-gray-700 mb-2">الاسم الأخير</label>
                            <input type="text" id="last_name" name="last_name" 
                                   value="{{ user.last_name|default:'' }}"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                    </div>
                    
                    <!-- اسم المستخدم -->
                    <div>
                        <label for="username" class="block text-gray-700 mb-2">اسم المستخدم</label>
                        <input type="text" id="username" value="{{ user.username }}" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                        <p class="text-gray-500 text-sm mt-1">لا يمكن تغيير اسم المستخدم</p>
                    </div>
                    
                    <!-- البريد الإلكتروني -->
                    <div>
                        <label for="email" class="block text-gray-700 mb-2">البريد الإلكتروني</label>
                        <input type="email" id="email" value="{{ user.email }}" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                        <p class="text-gray-500 text-sm mt-1">لا يمكن تغيير البريد الإلكتروني</p>
                    </div>
                    
                    <!-- السيرة الذاتية -->
                    <div>
                        <label for="bio" class="block text-gray-700 mb-2">السيرة الذاتية</label>
                        <textarea id="bio" name="bio" rows="3"
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                  placeholder="اكتب عن نفسك...">{{ user.bio|default:'' }}</textarea>
                        <p class="text-gray-500 text-sm mt-1">يمكنك كتابة ما يصل إلى 500 حرف</p>
                    </div>
                    
                    <!-- الموقع -->
                    <div>
                        <label for="location" class="block text-gray-700 mb-2">الموقع</label>
                        <input type="text" id="location" name="location" 
                               value="{{ user.location|default:'' }}"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                               placeholder="المدينة، الدولة">
                    </div>
                    
                    <!-- الموقع الإلكتروني -->
                    <div>
                        <label for="website" class="block text-gray-700 mb-2">الموقع الإلكتروني</label>
                        <input type="url" id="website" name="website" 
                               value="{{ user.website|default:'' }}"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                               placeholder="https://example.com">
                    </div>
                </div>
            </div>
            
            <!-- أزرار الحفظ -->
            <div class="mt-8 pt-6 border-t flex justify-end space-x-4">
                <a href="{% url 'profile_with_username' user.username %}" 
                   class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition">
                    إلغاء
                </a>
                <button type="submit" 
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition">
                    حفظ التغييرات
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function previewProfileImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewDiv = document.getElementById('profile-image-preview');
            let img = previewDiv.querySelector('img');
            
            if (!img) {
                img = document.createElement('img');
                img.className = 'h-40 w-40 rounded-full object-cover border-4 border-white shadow-lg';
                previewDiv.querySelector('div').replaceWith(img);
            }
            
            img.src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function previewCoverImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewDiv = document.getElementById('cover-image-preview');
            let img = previewDiv.querySelector('img');
            
            if (!img) {
                img = document.createElement('img');
                img.className = 'h-40 w-full object-cover';
                previewDiv.querySelector('div').replaceWith(img);
            }
            
            img.src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock %}
